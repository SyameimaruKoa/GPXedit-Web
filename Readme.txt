ブラウザ上で動くGPXファイルを編集するツールです。
ルート(トラック)の新規作成、分割、部分除去、結合、時間変更、名前変更、逆ルート変換、トラックポイントの移動、間引き、削除、追加ができます。


１．使い方

ブラウザでhtmファイルを開くと地図が表示され、マウスのホイールや地図上のボタンで縮尺が変えられ、ドラッグで移動できます。

GPXファイルの読み込みは、ファイルを画面にドラッグ&ドロップするかファイル選択ボタンで行います。
ファイルを読み込むと地図がルートの周辺に変わり、ルートが赤線で示されます。
ルートの終端にあるマゼンタのドットは開始点、シアンのドットが終了点を示します。
ルートが幾つかのトラックで構成されているときは、開始点/終了点のマーカーも各トラックに表示されますが、開始点と終了点が近接している場合、重なってどちらかが見えない事もあります。
読み込むルートの数に制約はありません。[読み込みルート]の下に読み込んだルートのリストが表示されます。

既に同じ名前のルートが読み込まれている場合、ルートが違っても名前が同じファイルは読み込めません。どちらかのルートの名前を変更してください。
名前が異なり同じ軌跡を持つルートの場合は、読み込みはできますが軌跡が重なるため後から読み込んだ方しか選択できません。（トラック編集で軌跡を一部変更して、軌跡の異なる部分をつくれば選択出来るようになります。）

ルートの編集は、目的の作業を選んでから地図上の目的のルートをクリックし選択し、必要な作業/設定を行って確定するという流れになります。
編集は読み込んだデータで行われ、元のGPXファイルには何もしません。
各変更を確定する前に作業の選択を変更すると、リセットされてそれまでの作業が消えますのでご注意ください。

なお、GPXファイルに含まれるウェイポイント（<wpt>要素）やその他の情報（<extensions>要素等）は最初のトラック（<trk>要素）の前まではヘッダーとして保持され、トラックやトラックポイント（<trkpt>要素）に速度やその他の情報があっても省かれます。
（編集後は基本的に必要な緯度、経度、標高、時間のデータだけになります。）

時間と標高データの無いファイルにも対応していますが、ほとんどの編集作業は時間データを基準にしているため、時間データが無い場合は、逆ルート変換とルート/トラックの名前変更しかできません。
時間変更で時間を設定すれば通常のルートとして編集できます。

標高データが無い場合は国土地理院のサーバーからデータをダウンロードして設定しますが、ポイント数の多いルートでは標高データ取得に時間がかかるため、通信環境によっては上手く設定されない事があります。
その場合に、読み込んだルートを削除して再度読み込めば、途中までの標高データは保持されていますので、短い時間でも上手く設定できます。


２．各作業の説明

（１）ルート作成
マウスをクリックしたポイントにマーカが表示され、所要ルートに沿って順次クリックして行くとマーカーが、仮のルートを示す青いラインで繋がって行きます。
クリックポイントの標高データを地理院のサーバーからダウンロードしているため、反応が0.1秒程度遅れる事があります。

各マーカーはドラッグすれば移動でき、不要なマーカは再度クリックすれば消去できます。
マーカーとマーカーの間のラインに新たにマーカーを追加することはできませんが、トラック編集では追加できるので、最初は粗くルートを作成し、トラック編集で詳細を決めるという使い方もできます。

ルートが出来たら、ルートとトラックの名前、スタートとゴールの時間を設定してルートを「確定」ボタンを押すとルートが赤線になります。
デフォルトで表示されている名前は適宜変更してください。（以下、他の作業でも同じ）
トラック名はブランクにしても大丈夫ですが、ルート名は[読み込みルート]に無い名前で必ず必要です。
日付を跨いだ時間設定はできませんので、数日に渡るルートを作成する時は日付毎にルートを作成し、ルートを結合してください。
全行程のルートを作成して適当な時間を設定しておき、後でそのルートを分割して、それぞれの日時を変えるという方法もあります。


（２）トラック編集
目的のルート/トラックをクリックすると、各トラックポイントにマーカが示され仮のルート(青ライン)が表示されます。そのマーカーの移動、削除、追加でトラックを編集します。
ルートが１つのトラックだけのときはルート全体、複数のトラックで構成されているときは、クリックしたトラックのみが編集する範囲になります。

編集する範囲のトラックポイントが多いと動作が著しく遅くなりますので、トラックポイントの多いルートは最大で1000ポイントくらいを目安に分割し、編集後に結合してください。
ポイント数は、作業選択の「ポイント間引き」を選択し、目的のルートをクリックすると表示されます。 

マーカーを移動や削除すると、それを繋ぐ仮のルートも変わります。元ルートの赤いラインは、「確定」ボタンを押すまでそのまま残っています。
マーカーとマーカーの間の青ラインをクリックすれば、そこにマーカーが追加されます。
ライン以外にマーカは追加できません、ライン上に追加して移動してください。
始点と終点も削除できますが、そのポイントの時間データが失われますので、それを考慮する必要があります。
追加したマーカーの標高データは地理院のサーバーからダウンロードされ、時間データは前後のマーカー間の時間が標高差と距離に応じて配分された値になります。


（３）ルート分割
ルート上の分割したい地点をクリックすると、そこに一番近いトラックポイントに分割ポイントのマーカーが付きます。
マーカーをクリックすればキャンセルできます。
分割は開始点から分割ポイントの前までと、分割ポイントを含んで終了点までに分けられます。
前半と後半のルート名を決めて確定します。


（４）ルート部分削除
マーカー２つ設定して削除する部分を選び、「確定」すればその部分が削除されます。
始点からマーカーまで、マーカーから終点までを削除する場合は、マーカーは一つでも構いません。
マーカーの設置に順序はなく、キャンセルはそのマーカーをクリックします。


（５）ルート結合
ルートを２つ選択し、時系列に結合します。選択したトラックを再度クリックすると選択をキャンセルできます。
複数のトラックが含まれている場合、全てのトラックを統合してトラックが一つだけのルートにするモードと、トラックを残して結合するモードがあります。
結合後のルート名に、結合前と同じ名前を使うと正常に動作しなくなります。
１文字でも良いので変えた名前で結合し、結合後に名前を変更してください。

ルートのトラックを統合するだけの場合は、１つだけルートを選択し「トラックを統合して結合」で行います。
この場合、結合後のルート名は設定する必要はなく、設定してもルート名は変わりません。


（６）ポイント間引き
トラックポイントを指定した間隔(ｍ)で間引きます。
間引く間隔はトラックポイント間の距離を積算して判断しているため正確ではなく、多少の誤差を含みます。


（７）時間変更
ルートの始点から終点までの各ポイントの時間を距離と標高差に応じて配分した時間に置き換えます。
日付を跨いだ設定はできませんので、その場合は日付毎にルートを分割し個別に設定してください。
また、複数のトラックがあるルートで、トラック毎に時間を設定したい場合も同様に分割して行ってください。
時間配分の比率はソースファイルの定数を変更すれば変えられます。(カスタマイズを参照してください）


（８）名前変更
ルートとトラックの名前を変更します。
トラック名は<name>の後に所要の名前(半角、全角いずれも可)、<number>の後に数字(半角)を付けます。
トラック名、numberはブランクにできますが、その場合も<name><number>の形にしてください。


（９）逆ルート変換
ルートの始点と終点を反転します。
時間データが失われますので、変換後に時間変更で再設定してください。


（１０）ルート削除
選択したルートを、地図と読み込みリストからから削除します。
確認等は無く、ルートをクリックすると即削除されますので、編集したルートを保存していない時には注意してください。
また、ファイルを読み込んだ時にルート削除になっていると、作業選択を変えずにルートをクリックすると削除されますので、それも注意してください。


（１１）ポイント情報(時間変更)
ルートをクリックした点に一番近いトラックポイントの情報が示されます。indexはトラックでの0から始まる順序です。
そのポイントの時間も変更できますが、前後のポイントとの時間の関係がずれるとアプリによってはルートが乱れますので注意してください。


（１２）ファイル出力
出力するファイル名を決めて保存すると、ダウンロードフォルダにGPXファイルが出力されます。


（１３）地図ジャンプ
表示される山域をクリックすると地図がその山域に移動し、縮尺も変わります。
山域はソースファイルの定数を変更することで変えられます。(カスタマイズを参照してください）

また、[読み込みルート]に示されているルート名をダブルクリックすると、そのルート全体が表示できる縮尺で、そこにジャンプします。
ただし、ダブルクリックして選択できる文字列の範囲がブラウザによって異なるため、同じ文字が使われているルートがある場合、所要の場所にジャンプしない事があります。異なる文字をクリックするようにしてください。



３．カスタマイズ

（１）時間配分
ソースコードの8行目からの傾斜に対する速度比、及び傾斜レンジの閾値を変えれば、ルート作成や時間変更での時間配分も変わります。
この値を自分の速度に合わせた値にすれば、欠落したGPSログを補完する時などに、より自然な時間配分にできます。


（２）地図ジャンプ
地図ジャンプのジャンプ先は、ソースコード17行目からのjumpListの配列の値を変更すると変えられます。
ジャンプ先の記述フォーマットは、ジャンプ先名称、地図縮尺値、ジャンプ先緯度経度をスラッシュ(/)で区切り、それをダブルクォーテーションで囲ってカンマで区切ったものです。(改行はしても、しなくてもOK）

例：
"奥多摩/12/35.779436/139.127785",

縮尺値や緯度経度は国土地理院の地図( https://maps.gsi.go.jp/ )で目的の場所を表示したときのurlで、#に続く３つの数値をコピーすれば、ジャンプ先も同じ場所とスケールになります。

例：
https://maps.gsi.go.jp/#13/35.711117/137.821426/&base=std&ls=std&disp=1&vs=c1j0h0k0l0u0t0z0r0s0m0f1



４．リセット

入手し得えた範囲のGPSファイルで動作チェックしていますが、GPSファイルの書式によっては予期しない動作になる可能性も残っています。
例えば、ルートは表示されても読み込みリストには出てこない、逆にリストにはあっても地図に表示されない、編集作業ができない等。
そのような場合には、ブラウザでリロード(htmの再読み込み)するか、タブを閉じて再度立ち上げてください。

